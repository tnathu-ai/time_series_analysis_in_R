---
title: "assignment1Solution_s3879312"
author: "Thu Tran"
date: "`r Sys.Date()`"
output: pdf_document
---

## R Markdown

```{r import libraries}
rm(list=ls()) 
library(TSA)
library(tseries)
```


```{r adds a column header and print the info of the provided CSV dataset}
portfolio <- read.csv("assignment1Data2023.csv", header=TRUE)
# Add a column header
colnames(portfolio) <- c("id", "x")
# class of the data set
class(portfolio)
# View the data set
print(portfolio)
# summary statistics
summary(portfolio)
```

```{r Create the ACF plot for finding the frequency}
# Create the ACF plot for original portfolio data
acf(portfolio)
# Find the frequency
frequency(portfolio)
```



```{r convert to time series object with the frequency of 2}
# Convert to time series object
freq <- 252/as.numeric(diff(range(portfolio$id), units = "days"))
ts_portfolio <- ts(portfolio$x, frequency = freq)
# Check the structure of the time series object
str(ts_portfolio)
# class of the converted data
class(ts_portfolio)
# View the time series object
print(ts_portfolio)

```


```{r ACF plot with frequency of 2}
# Create the ACF plot 
acf(ts_portfolio)
# Find the frequency
frequency(ts_portfolio)
```


```{r time series plot}
# Create a time series plot and add axis labels
plot(ts_portfolio, type='o', main = "Time series plot of Daily Returns of Investment Portfolio", ylab = "Return (AUD100,000)", xlab = "Trading Days", col="blue")
```

```{r scatter plot}
plot(y=ts_portfolio,x=zlag(ts_portfolio),ylab='Return (AUD100,000)', xlab='Previous Year Return (AUD100,000)', main = "Scatter plot of Daily Investment Return in Consecutive Years", col="blue")
```

```{r find correlation in this scatter plot}
y = ts_portfolio             # Read the data into y
x = zlag(ts_portfolio)       # Generate first lag of the  series
index = 2:length(x)    # Create an index to get rid of the first NA value in x if applicable
cor(y[index],x[index]) # Calculate correlation between numerical values in x and y
```


```{r Augmented Dickey-Fuller Test to determine Deterministic Versus Stochastic Trends}
# Perform ADF test
adf.test(ts_portfolio)
```

```{r plot decomsed time series}
# Decompose the time series into its components
ts_decomp <- decompose(ts_portfolio)
# Plot the decomposed components
plot(ts_decomp, col="blue")
```


```{r deterministic linear trend model}
# the summary of the deterministic linear trend model
linear_model = lm(ts_portfolio~time(ts_portfolio)) # label the model as linear_model
summary(linear_model)
```


```{r Plot the deterministic linear trend model with the fitted trend line}
plot(ts_portfolio, type='o',ylab='Return (AUD100,000)', main = "Fitted linear model to the Daily Returns of Investment Portfolio", col="blue")
abline(linear_model, col="red") # add the fitted least squares line from linear model
```


```{r deterministic quadratic trend model}
# the summary of the deterministic quadratic trend model
t = time(ts_portfolio)
t2 = t^2
quadratic_model = lm(ts_portfolio~t+t2) # label the model as quadratic_model
summary(quadratic_model)
```



```{r Fitted quadratic curve to the Daily Returns of Investment Portfolio}
plot(ts(fitted(quadratic_model)), ylim = c(min(c(fitted(quadratic_model),
     as.vector(ts_portfolio))), max(c(fitted(quadratic_model),as.vector(ts_portfolio)))),ylab='Return (AUD100,000)' ,
     main = "Fitted quadratic curve to the Daily Returns of Investment Portfolio", col="red")
lines(as.vector(ts_portfolio),type="o", col="blue")
```

```{r seasonal deterministic trend model}
month.=season(ts_portfolio)
# Season() function creates a factor variable showing the months.
# period added to improve table display and this line sets up indicators
season_model=lm(ts_portfolio ~ month.-1) # add -1 to remove the intercept term
summary(season_model)
```

```{r Fitted seasonal curve to the Daily Returns of Investment Portfolio}
plot(ts(fitted(season_model)), ylab='Return (AUD100,000)', main = "Fitted seasonal deterministic model without intercept", ylim = c(min(c(fitted(season_model), as.vector(ts_portfolio))), max(c(fitted(season_model), as.vector(ts_portfolio)))), col = "red" )
lines(as.vector(ts_portfolio),type="o", col = "blue")
```
# Cosine Trend

```{r cosine trend model}
cosine_model <- lm(ts_portfolio ~ cos(2*pi*time(ts_portfolio)) + sin(2*pi*time(ts_portfolio)))
summary(cosine_model)
```


```{r}
plot(ts(fitted(cosine_model)), ylab='Return (AUD100,000)', main = "Fitted cosine wave.",ylim = c(min(c(fitted(cosine_model), as.vector(ts_portfolio))) ,
max(c(fitted(cosine_model), as.vector(ts_portfolio)))
), col = "red" )
lines(as.vector(ts_portfolio),type="o", col="blue")
```



```{r Cyclical Trends model}
cyclical_model <- lm(ts_portfolio ~ sin(2*pi*time(ts_portfolio)) + cos(2*pi*time(ts_portfolio)))
summary(cyclical_model)
```


```{r}
plot(ts(fitted(cyclical_model)), ylab='Return (AUD100,000)', main = "Fitted Cyclical Model",ylim = c(min(c(fitted(cyclical_model), as.vector(ts_portfolio))) ,
max(c(fitted(cyclical_model), as.vector(ts_portfolio)))
), col = "red" )
lines(as.vector(ts_portfolio),type="o", col="blue")
```



```{r}
# Fit linear, quadratic, cosine, cyclical, and seasonal trend models
linear_model <- linear_model
quadratic_model <- quadratic_model
season_model <- season_model
cosine_model <- cosine_model
cyclical_model <- cyclical_model

# Compute the residual sum of squares (RSS) for each model
linear_RSS <- sum(resid(linear_model)^2)
quadratic_RSS <- sum(resid(quadratic_model)^2)
season_RSS <- sum(resid(season_model)^2)
cosine_RSS <- sum(resid(cosine_model)^2)
cyclical_RSS <- sum(resid(cyclical_model)^2)

# Compute the R-squared for each model
linear_r_squared <- summary(linear_model)$r.squared
quadratic_r_squared <- summary(quadratic_model)$r.squared
season_r_squared <- summary(season_model)$r.squared
cosine_r_squared <- summary(cosine_model)$r.squared
cyclical_r_squared <- summary(cyclical_model)$r.squared

# Print the RSS for each model
cat("Linear Model RSS:", linear_RSS, "\n")
cat("Quadratic Model RSS:", quadratic_RSS, "\n")
cat("Seasonal Model RSS:", season_RSS, "\n")
cat("Cosine Model RSS:", cosine_RSS, "\n")
cat("Cyclical Model RSS:", cyclical_RSS, "\n")

# Print the R-squared for each model
cat("\nLinear Model R-squared:", linear_r_squared, "\n")
cat("Quadratic Model R-squared:", quadratic_r_squared, "\n")
cat("Seasonal Model R-squared:", season_r_squared, "\n")
cat("Cosine Model R-squared:", cosine_r_squared, "\n")
cat("Cyclical Model R-squared:", cyclical_r_squared, "\n")

# Select the model with the lowest RSS
RSS <- c(linear_RSS, quadratic_RSS, season_RSS, cosine_RSS, cyclical_RSS)
best_model <- which.min(RSS)

# Select the model with the highest RSS
R_2 <- c(linear_r_squared, quadratic_r_squared, season_r_squared, cosine_r_squared, cyclical_r_squared)
best_model <- which.min(RSS)

# Print the best fitting model in term of RSS
cat("\nBest Fitting Model in term of RSS:", c("Linear", "Quadratic", "Seasonal","Cosine", "Cyclical")[best_model])
# Print the best fitting model interm of R-squared
cat("\n\nBest Fitting Model in term of R-squared:", c("Linear", "Quadratic", "Seasonal","Cosine", "Cyclical")[best_model])


# Create a data frame of the evaluation metrics
compare_model_df <- data.frame(Model = c("Linear", "Quadratic", "Seasonal","Cosine", "Cyclical"), 
                           R_squared = c(linear_r_squared, quadratic_r_squared, season_r_squared, cosine_r_squared, cyclical_r_squared),
                           RSS = c(linear_RSS, quadratic_RSS, season_RSS, cosine_RSS, cyclical_RSS))

# Print the data frame
compare_model_df
```




```{r}
create_residual_plots <- function(model_list, ts_data) {
  n_models <- length(model_list)
  par(mfrow=c(ceiling(n_models/2), 2)) # set up multiple plots
  
  for (i in seq_along(model_list)) {
    residuals <- rstudent(model_list[[i]])
    plot(residuals, xlab='Time', ylab='Standardized Residuals', 
         type='o', main = paste("Residual Plot for", names(model_list)[i]), col="blue")
  }
  
  par(mfrow=c(1, 1)) # reset plot settings
}

models_list <- list(linear_model, quadratic_model, season_model, cosine_model, cyclical_model)
names(models_list) <- c("Linear Model", "Quadratic Model", "Seasonal Model", "Cosine Model", "Cyclical Model")

create_residual_plots(models_list, ts_portfolio)

```


```{r}
create_residual_hist_plots <- function(model_list) {
  n_models <- length(model_list)
  par(mfrow=c(ceiling(n_models/2), 2)) # set up multiple plots
  
  for (i in seq_along(model_list)) {
    residuals <- rstudent(model_list[[i]])
    hist(residuals, xlab='Standardized Residuals', 
         main = paste("Histogram of Standardized Residuals for", names(model_list)[i]), col="blue")
  }
  
  par(mfrow=c(1, 1)) # reset plot settings
}
models_list <- list(linear_model, quadratic_model, season_model, cosine_model, cyclical_model)
names(models_list) <- c("Linear", "Quadratic", "Seasonal", "Cosine", "Cyclical")
create_residual_hist_plots(models_list)

```

```{r}
plot_qq_all_models <- function(model_list) {
  n_models <- length(model_list)
  par(mfrow=c(ceiling(n_models/2), 2)) # set up multiple plots
  
  for (i in seq_along(model_list)) {
    residuals <- rstudent(model_list[[i]])
    qqnorm(residuals, col="blue", main = paste("Standardized Residuals Q-Q Plot for", names(model_list)[i]))
    qqline(residuals, col = "red")
  }
  
  par(mfrow=c(1, 1)) # reset plot settings
}
models <- list(linear_model, quadratic_model, season_model, cosine_model, cyclical_model)
names(models) <- c("Linear Model", "Quadratic Model", "Seasonal Model", "Cosine Model", "Cyclical Model")

plot_qq_all_models(models)

```

```{r Normality Test (Shapiro-Wilk)}
shapiro_test <- function(model) {
  residuals <- rstudent(model)
  shapiro.test(residuals)
}
for (i in seq_along(models)) {
  print(names(models)[i])
  print(shapiro_test(models[[i]]))
}

```


```{r ACF plots for the standardized residuals}
plot_standardized_resid_acf <- function(models_list) {
  for (i in 1:length(models_list)) {
    model_name <- deparse(substitute(models_list[[i]]))
    resid <- rstudent(models_list[[i]])
    acf(resid, main = paste0("ACF of standardized residuals for ", names(models)[i]))
  }
}

models <- list(linear_model, quadratic_model, season_model, cosine_model, cyclical_model)
names(models) <- c("Linear Model", "Quadratic Model", "Seasonal Model", "Cosine Model", "Cyclical Model")
plot_standardized_resid_acf(models)
```



# Forecasting with quadratic models

```{r}
h <- 15 # 15 steps ahead forecasts
t <- time(ts_portfolio)
t2 <- t^2
aheadTimes <- data.frame(t = seq(127, 127+h, 1),
t2 = seq(127, 127+h, 1)^2)
quadratic_model_prediction <- predict(quadratic_model, newdata = aheadTimes, interval = "prediction")
quadratic_model_prediction
```

```{r}
plot(ts_portfolio, xlim= c(1,127+h+1), ylim = c(-50,157),
ylab = "Return (AUD100,000)",
main = "Sample forecasts from Quadratic Model for the next 15 trading days")
lines(ts(as.vector(quadratic_model_prediction[,3]), start = 127), col="blue", type="l")
lines(ts(as.vector(quadratic_model_prediction[,1]), start = 127), col="red", type="l")
lines(ts(as.vector(quadratic_model_prediction[,2]), start = 127), col="blue", type="l")
legend("topleft", lty=1, pch=1, col=c("black","blue","red"),
text.width = 12,
c("Data","5% forecast limits", "Forecasts"))
```





